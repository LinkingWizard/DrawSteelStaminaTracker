<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Draw Steel – Stamina Tracker</title>
  <style>
    /* Basic body and app container styling */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 420px;
      padding: 1rem;
    }

    /* Header styling */
    h1 {
      text-align: center;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    /* Subheader styling */
    h3 {
      text-align: center;
      font-size: 1.00rem;
      margin-bottom: 1rem;
    }


    /* Card container styling */
    .card {
      background: #020617;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    /* Stamina display styling */
    .stamina-display {
      text-align: center;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .stamina-value {
      font-size: 3rem;
      font-weight: 700;
    }

    /* Text colors for over and under stamina */
    .over { color: #22c55e; }
    .under { color: #ef4444; }

    /* Temp stamina display styling */
    .temp-display {
      text-align: center;
      font-size: 1rem;
      color: #22c55e;
      margin-bottom: 1rem;
      display: none;
    }

    .stamina-max {
      font-size: 0.875rem;
      color: #94a3b8;
    }

    /* Grid layout for buttons */
    .row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .row.two {
      grid-template-columns: repeat(2, 1fr);
    } 

    .row.single {
      grid-template-columns: 1fr;
    }

    /* Button styling */
    button {
      background: #1e293b;
      color: #e5e7eb;
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem 0;
      font-size: 1rem;
      font-weight: 600;
    }

    button:active { background: #334155; }

    /* Input styling */
    input {
      width: 100%;
      box-sizing: border-box;
      padding: 0.6rem;
      border-radius: 0.5rem;
      border: none;
      background: #020617;
      color: #e5e7eb;
      text-align: center;
      font-size: 1rem;
    }

    .setup { margin-bottom: 1rem; }

    .apply-row {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    /* Stamina bar container styling */
    .stamina-bar {
      height: 20px;
      width: 100%;
      background: #1e293b;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
      position: relative;
    }

    /* Individual segments inside the stamina bar */
    .stamina-segment {
      height: 100%;
      position: absolute;
      top: 0;
      transition: width 0.2s;
    }

    .stamina-green { background: green; z-index: 3; left: 0; }
    .stamina-yellow { background: yellow; z-index: 3; left: 0; }
    .stamina-red { background: red; z-index: 2; }
    .stamina-black { background: black; z-index: 1; }
  </style>
</head>
<body>
  <div class="app">

<!-- Setup Screen -->
<div class="card" id="setupScreen">
  <h1>Draw Steel</h1>
  <h3>Enter Max Values</h3>

  <div class="setup">
    <input id="maxInput" type="number" placeholder="Max stamina" />
  </div>

  <div class="setup">
    <input id="maxRecoveriesInput" type="number" placeholder="Max Recoveries" />
  </div>

  <div class="row single">
    <button onclick="startTracker()">Next</button>
  </div>
</div>

<!-- Stamina Tracker (Hidden on launch) -->
<div class="card" id="trackerScreen" style="display:none;">
  <h1>Stamina Tracker</h1>

  <div class="stamina-bar" id="staminaBar">
    <div class="stamina-segment stamina-green" id="staminaGreen"></div>
    <div class="stamina-segment stamina-yellow" id="staminaYellow"></div>
    <div class="stamina-segment stamina-red" id="staminaRed"></div>
    <div class="stamina-segment stamina-black" id="staminaBlack"></div>
  </div>

  <div class="stamina-display">
    <div class="stamina-value" id="currentStamina">0</div>
    <div class="stamina-max">/ <span id="maxStamina">0</span></div>
  </div>

  <div class="temp-display" id="tempDisplay">
    Temp Stamina: <span id="tempValue">0</span>
  </div>

  <!-- Winded/Dying/Dead display -->
  <div id="conditionDisplay"
        style="text-align:center;font-size:0.9rem;font-weight:700;display:none;">
  </div>

  <!-- Action buttons -->
  <div class="row">
    <button onclick="openDamageMenu()">Damage</button>
    <button onclick="openTempMenu()">Temp Stamina</button>
    <button onclick="openMaxMenu()">Settings</button>
  </div>

  <!-- Damage Menu -->
  <div class="card" id="damageMenu" style="display:none;margin-top:1rem;">
    <h3>Enter Damage</h3>

    <input id="damageInput" type="number" value="0" />

    <div class="row">
      <button onclick="adjustDamage(1)">+1</button>
      <button onclick="adjustDamage(5)">+5</button>
      <button onclick="adjustDamage(10)">+10</button>
    </div>

    <div class="row">
      <button onclick="adjustDamage(-1)">-1</button>
      <button onclick="adjustDamage(-5)">-5</button>
      <button onclick="adjustDamage(-10)">-10</button>
    </div>

    <div class="row single">
      <button onclick="applyDamage()">Apply</button>
    </div>
  </div>

  <!-- Temp Stamina Menu -->
  <div class="card" id="tempMenu" style="display:none;margin-top:1rem;">
    <h3>Enter Temp Stamina</h3>

    <input id="tempInput" type="number" value="0" />

    <div class="row">
      <button onclick="adjustTemp(1)">+1</button>
      <button onclick="adjustTemp(5)">+5</button>
      <button onclick="adjustTemp(10)">+10</button>
    </div>

    <div class="row">
      <button onclick="adjustTemp(-1)">-1</button>
      <button onclick="adjustTemp(-5)">-5</button>
      <button onclick="adjustTemp(-10)">-10</button>
    </div>

    <div class="row single">
      <button onclick="applyTemp()">Apply</button>
    </div>
  </div>

  <div class="row single">
    <button onclick="resetStamina()">Reset Stamina</button>
  </div>
</div>

<!-- Recoveries Tracker -->
<div class="card" id="recoveryTracker" style="margin-top:1rem;display:none;">
  <h3 style="text-align:center;">Recoveries</h3>  

  <div style="
    display:grid;
    grid-template-columns: 1fr 2fr 1fr;
    align-items:center;
    text-align:center;
    margin-bottom:0.5rem;
  ">
    <button onclick="adjustRecoveries(-1)">−</button>

    <div class="stamina-display">
      <div class="stamina-value" id="recoveryValue">0</div>
      <div class="stamina-max">/ <span id="recoveryMax">0</span></div>
    </div>

    <button onclick="adjustRecoveries(1)">+</button>
  </div>


  <div class="row two">
    <button onclick="resetRecoveries()">Reset</button>
    <button onclick="useRecovery()">Recover</button>
  </div>
</div>

<!-- Heroic Resource Tracker -->
<div class="card" style="margin-top:1rem;">
  <h3 style="text-align:center;">Heroic Resource</h3>

  <div style="
    display:grid;
    grid-template-columns: 1fr 2fr 1fr;
    align-items:center;
    text-align:center;
    margin-top:0.5rem;
  ">
    <button onclick="adjustHeroic(-1)">−</button>

    <div id="heroicValue"
         style="font-size:3rem;font-weight:700;">
      0
    </div>

    <button onclick="adjustHeroic(1)">+</button>
  </div>
</div>


<script>
  // Stamina variables
  let base = 0;  // Current base stamina
  let max = 0;   // Maximum stamina
  let temp = 0;  // Temporary stamina buffer
  let heroic = 0; // Heroic resource value
  let recoveries = 0; // Current recoveries value
  let maxRecoveries = 0; // Maximum recoveries

  // DOM elements
  const currentEl = document.getElementById('currentStamina');
  const maxEl = document.getElementById('maxStamina');
  const tempEl = document.getElementById('tempValue');
  const tempDisplay = document.getElementById('tempDisplay');
  const maxInput = document.getElementById('maxInput');
  const customInput = document.getElementById('customInput');
  
  const damageMenu = document.getElementById('damageMenu');
  const damageInput = document.getElementById('damageInput');
  const tempMenu = document.getElementById('tempMenu');
  const tempInput = document.getElementById('tempInput');
  const setupScreen = document.getElementById('setupScreen');
  const trackerScreen = document.getElementById('trackerScreen');

  const greenSeg = document.getElementById('staminaGreen');
  const yellowSeg = document.getElementById('staminaYellow');
  const redSeg = document.getElementById('staminaRed');
  const blackSeg = document.getElementById('staminaBlack');

  const heroicEl = document.getElementById('heroicValue');
  const recoveryEl = document.getElementById('recoveryValue');
  const maxRecoveriesInput = document.getElementById('maxRecoveriesInput');
  const recoveryTracker = document.getElementById('recoveryTracker');
  const recoveryMaxEl = document.getElementById('recoveryMax');


  // Update max stamina when input changes, without resetting current stamina
  maxInput.addEventListener('change', () => {
    const newMax = parseInt(maxInput.value, 10) || 0;
    // Automatically reset stamina if max field is empty
    if (max == 0) {
    max = newMax
    resetStamina();
    } else {
    max = newMax;
    }
    updateDisplay();
  });

  // Apply custom stamina adjustment from input box
  function applyCustom() {
    const raw = customInput.value.trim();
    const cleaned = raw.startsWith('+') ? raw.slice(1) : raw;  // Ignore leading '+'
    let value = parseInt(cleaned, 10);

    if (!isNaN(value)) {
      if (value < 0) {
        // Take damage from temp first, then base
        let damage = -value;
        if (temp >= damage) {
          temp -= damage;
        } else {
          damage -= temp;
          temp = 0;
          base -= damage;
        }
      } else {
        base += value;  // Positive adjustment
      }
      updateDisplay();
    }
    customInput.value = '';
  }

  // Increase temp stamina
  function addTemp(amount) {
    temp += amount;
    if (temp < 0) temp = 0;
    updateDisplay();
  }

  // Reset temp stamina to zero
  function resetTemp() {
    temp = 0;
    updateDisplay();
  }

  // Recover stamina by 1/3 of max (capped at max)
  function recover() {
    const recoveryValue = Math.floor(max / 3);
    base += recoveryValue;
    if (base > max) base = max;
    updateDisplay();
  }

  // Reset base stamina to max and clear temp stamina
  function resetStamina() {
    base = max;
    temp = 0;
    updateDisplay();
  }

  // Opens setup screen on launch
  function startTracker() {
    const staminaValue = parseInt(maxInput.value, 10);
    const recoveryValue = parseInt(maxRecoveriesInput.value, 10);

    if (!staminaValue || staminaValue <= 0) return;
    if (!recoveryValue || recoveryValue <= 0) return;

    /* ---- Max Stamina ---- */
    if (max === 0) {
      max = staminaValue;
      base = max;
    } else {
      max = staminaValue;
      if (base > max) base = max;
    }

    /* ---- Recoveries ---- */
    if (maxRecoveries === 0) {
      // First launch only
      maxRecoveries = recoveryValue;
      recoveries = maxRecoveries;
    } else {
      // Adjustment later — do NOT reset
      maxRecoveries = recoveryValue;

      // Clamp recoveries to new max
      if (recoveries > maxRecoveries) {
        recoveries = maxRecoveries;
      }
    }

    setupScreen.style.display = 'none';
    trackerScreen.style.display = 'block';
    recoveryTracker.style.display = 'block';

    updateRecoveriesDisplay();
    updateDisplay();
  }

  // Opens max stamina
  function openMaxMenu() {
    setupScreen.style.display = 'block';
    trackerScreen.style.display = 'none';
    recoveryTracker.style.display = 'none';

    // Pre-fill current max stamina
    maxInput.value = max;
  }
  
  // Opens damage menu on button press
  function openDamageMenu() {
    damageMenu.style.display = 'block';
    tempMenu.style.display = 'none';
    damageInput.value = 0;
  }

  // Opens temp stamina menu on button press
  function openTempMenu() {
    tempMenu.style.display = 'block';
    damageMenu.style.display = 'none';
    tempInput.value = 0;
  }

  // Changes temp stamina displayed on button press
  function adjustTemp(amount) {
    const current = parseInt(tempInput.value, 10) || 0;
    tempInput.value = current + amount;
  }

  // Changes damage displayed on button press
  function adjustDamage(amount) {
    let current = parseInt(damageInput.value, 10) || 0;
    current += amount;

    // Prevent button presses from making value negative
    if (current < 0) current = 0;

    damageInput.value = current;
  }

  // Deals damage
  function applyDamage() {
    let value = Math.abs(parseInt(damageInput.value, 10));

    if (isNaN(value) || value <= 0) return;

    // Damage removes temp first
    if (temp >= value) {
      temp -= value;
    } else {
      value -= temp;
      temp = 0;
      base -= value;
    }

    damageMenu.style.display = 'none';
    updateDisplay();
  }

  // Adds temp stamina
  function applyTemp() {
    let value = parseInt(tempInput.value, 10);

    // Sanitize input
    if (isNaN(value) || value <= 0) return;

    temp += value;

    tempMenu.style.display = 'none';
    updateDisplay();
  }

  // Update all displays and stamina bar
  function updateDisplay() {
    // Update base stamina text and colors
    currentEl.classList.remove('over', 'under');
    currentEl.textContent = base;
    maxEl.textContent = max;
    if (base > max && max > 0) currentEl.classList.add('over');
    if (base < 0) currentEl.classList.add('under');

    // Show/hide temp stamina display
    if (temp > 0) {
      tempDisplay.style.display = 'block';
      tempEl.textContent = temp;
    } else {
      tempDisplay.style.display = 'none';
    }

    // Determine character condition
    const windedValue = Math.floor(max / 2);
    const conditionEl = document.getElementById('conditionDisplay');
    let text = '';
    let color = '';

    if (base <= -windedValue && windedValue > 0) {
      text = 'Dead';
      color = '#ef4444';
    } else if (base <= 0) {
      text = 'Dying';
      color = '#ef4444';
    } else if (base <= windedValue && max > 0) {
      text = 'Winded';
      color = '#facc15';
    }

    if (text) {
      conditionEl.textContent = text;
      conditionEl.style.color = color;
      conditionEl.style.display = 'block';
    } else {
      conditionEl.style.display = 'none';
    }

    // Calculate stamina bar segments
    let green = 0, yellow = 0, red = 0, black = 0;

    if (base >= max) {
      green = 100;  // Full green bar
    } else if (base > 0) {
      if (base <= windedValue) {
        yellow = (base / max) * 100;  // Winded portion
      } else {
        green = (base / max) * 100;
      }
    } else {
      red = Math.min((-base <= windedValue ? -base : windedValue) / max * 100, 100);
      black = (-base > windedValue ? (-base - windedValue) / max * 100 : 0);
      if (base <= -windedValue) {
        red = 0;
        black = 100;
      }
    }

    // Update bar segment widths and visibility
    greenSeg.style.width = green + '%';
    greenSeg.style.display = green > 0 ? 'block' : 'none';
    yellowSeg.style.width = yellow + '%';
    yellowSeg.style.display = yellow > 0 ? 'block' : 'none';
    redSeg.style.width = red + '%';
    redSeg.style.left = (green + yellow) + '%';
    redSeg.style.display = red > 0 ? 'block' : 'none';
    blackSeg.style.width = black + '%';
    blackSeg.style.left = (green + yellow + red) + '%';
    blackSeg.style.display = black > 0 ? 'block' : 'none';
  }

  // Updates display
  function updateRecoveriesDisplay() {
    recoveryEl.textContent = recoveries;
    recoveryMaxEl.textContent = maxRecoveries;

    if (recoveries === 0) {
      recoveryEl.classList.add('under');
    } else {
      recoveryEl.classList.remove('under');
    }
  }

  // Changes recoveries on button press
  function adjustRecoveries(amount) {
    recoveries += amount;

    if (recoveries < 0) recoveries = 0;
    if (recoveries > maxRecoveries) recoveries = maxRecoveries;

    updateRecoveriesDisplay();
  }

  // Resets recoveries to max
  function resetRecoveries() {
    recoveries = maxRecoveries;
    updateRecoveriesDisplay();
  }

  // Removes one recovery and regains stamina
  function useRecovery() {
    if (recoveries <= 0) return;

    recoveries--;
    recover(); // existing stamina recovery logic

    updateRecoveriesDisplay();
  }

  // Changes heroic resource value
  function adjustHeroic(amount) {
    heroic += amount;
    heroicEl.textContent = heroic;

    if (heroic < 0) {
      heroicEl.style.color = '#ef4444'; // red
    } else {
      heroicEl.style.color = '#e5e7eb'; // normal text
    }
  }
</script>
</body>
</html>
