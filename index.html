<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Draw Steel – Stamina Tracker</title>
  <style>
    /* Basic body and app container styling */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 420px;
      padding: 1rem;
    }

    /* Header styling */
    h1 {
      text-align: center;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    /* Card container styling */
    .card {
      background: #020617;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    /* Stamina display styling */
    .stamina-display {
      text-align: center;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .stamina-value {
      font-size: 3rem;
      font-weight: 700;
    }

    /* Text colors for over and under stamina */
    .over { color: #22c55e; }
    .under { color: #ef4444; }

    /* Temp stamina display styling */
    .temp-display {
      text-align: center;
      font-size: 1rem;
      color: #22c55e;
      margin-bottom: 1rem;
      display: none;
    }

    .stamina-max {
      font-size: 0.875rem;
      color: #94a3b8;
    }

    /* Grid layout for buttons */
    .row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .row.single {
      grid-template-columns: 1fr;
    }

    /* Button styling */
    button {
      background: #1e293b;
      color: #e5e7eb;
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem 0;
      font-size: 1rem;
      font-weight: 600;
    }

    button:active { background: #334155; }

    /* Input styling */
    input {
      width: 100%;
      box-sizing: border-box;
      padding: 0.6rem;
      border-radius: 0.5rem;
      border: none;
      background: #020617;
      color: #e5e7eb;
      text-align: center;
      font-size: 1rem;
    }

    .setup { margin-bottom: 1rem; }

    .apply-row {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    /* Stamina bar container styling */
    .stamina-bar {
      height: 20px;
      width: 100%;
      background: #1e293b;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
      position: relative;
    }

    /* Individual segments inside the stamina bar */
    .stamina-segment {
      height: 100%;
      position: absolute;
      top: 0;
      transition: width 0.2s;
    }

    .stamina-green { background: green; z-index: 3; left: 0; }
    .stamina-yellow { background: yellow; z-index: 3; left: 0; }
    .stamina-red { background: red; z-index: 2; }
    .stamina-black { background: black; z-index: 1; }
  </style>
</head>
<body>
  <div class="app">
    <h1>Draw Steel Stamina Tracker</h1>

    <div class="card">
      <!-- Max stamina input -->
      <div class="setup">
        <label>Max Stamina</label>
        <input id="maxInput" type="number" placeholder="Enter max stamina" />
      </div>

      <!-- Custom stamina adjustment -->
      <div class="apply-row">
        <input id="customInput" type="text" placeholder="Adjust stamina (±)" />
        <button onclick="applyCustom()">Apply</button>
      </div>

      <!-- Stamina bar -->
      <div class="stamina-bar" id="staminaBar">
        <div class="stamina-segment stamina-green" id="staminaGreen"></div>
        <div class="stamina-segment stamina-yellow" id="staminaYellow"></div>
        <div class="stamina-segment stamina-red" id="staminaRed"></div>
        <div class="stamina-segment stamina-black" id="staminaBlack"></div>
      </div>

      <!-- Current stamina display -->
      <div class="stamina-display">
        <div class="stamina-value" id="currentStamina">0</div>
        <div class="stamina-max">/ <span id="maxStamina">0</span></div>
      </div>

      <!-- Temp stamina display -->
      <div class="temp-display" id="tempDisplay">
        Temp Stamina: <span id="tempValue">0</span>
      </div>

      <!-- Condition display (Winded/Dying/Dead) -->
      <div class="condition-display" id="conditionDisplay" style="text-align:center;font-size:0.9rem;font-weight:700;display:none;"></div>

      <!-- Temp stamina buttons -->
      <div class="row">
        <button onclick="addTemp(1)">+1</button>
        <button onclick="addTemp(5)">+5</button>
        <button onclick="addTemp(10)">+10</button>
      </div>

      <!-- Reset temp stamina button -->
      <div class="row single">
        <button onclick="resetTemp()">Reset Temp Stamina</button>
      </div>

      <!-- Recovery button -->
      <div class="row single">
        <button onclick="recover()">Recover</button>
      </div>

      <!-- Reset stamina button -->
      <div class="row single">
        <button onclick="resetStamina()">Reset Stamina</button>
      </div>
    </div>
  </div>

  <script>
    // Stamina variables
    let base = 0;  // Current base stamina
    let max = 0;   // Maximum stamina
    let temp = 0;  // Temporary stamina buffer

    // DOM elements
    const currentEl = document.getElementById('currentStamina');
    const maxEl = document.getElementById('maxStamina');
    const tempEl = document.getElementById('tempValue');
    const tempDisplay = document.getElementById('tempDisplay');
    const maxInput = document.getElementById('maxInput');
    const customInput = document.getElementById('customInput');

    const greenSeg = document.getElementById('staminaGreen');
    const yellowSeg = document.getElementById('staminaYellow');
    const redSeg = document.getElementById('staminaRed');
    const blackSeg = document.getElementById('staminaBlack');

    // Update max stamina when input changes, without resetting current stamina
    maxInput.addEventListener('change', () => {
      const newMax = parseInt(maxInput.value, 10) || 0;
      max = newMax;
      updateDisplay();
      // Automatically reset stamina if max field is empty
      if (max === 0) {
      resetStamina();
      }
    });

    // Apply custom stamina adjustment from input box
    function applyCustom() {
      const raw = customInput.value.trim();
      const cleaned = raw.startsWith('+') ? raw.slice(1) : raw;  // Ignore leading '+'
      let value = parseInt(cleaned, 10);

      if (!isNaN(value)) {
        if (value < 0) {
          // Take damage from temp first, then base
          let damage = -value;
          if (temp >= damage) {
            temp -= damage;
          } else {
            damage -= temp;
            temp = 0;
            base -= damage;
          }
        } else {
          base += value;  // Positive adjustment
        }
        updateDisplay();
      }
      customInput.value = '';
    }

    // Increase temp stamina
    function addTemp(amount) {
      temp += amount;
      if (temp < 0) temp = 0;
      updateDisplay();
    }

    // Reset temp stamina to zero
    function resetTemp() {
      temp = 0;
      updateDisplay();
    }

    // Recover stamina by 1/3 of max (capped at max)
    function recover() {
      const recoveryValue = Math.floor(max / 3);
      base += recoveryValue;
      if (base > max) base = max;
      updateDisplay();
    }

    // Reset base stamina to max and clear temp stamina
    function resetStamina() {
      base = max;
      temp = 0;
      updateDisplay();
    }

    // Update all displays and stamina bar
    function updateDisplay() {
      // Update base stamina text and colors
      currentEl.classList.remove('over', 'under');
      currentEl.textContent = base;
      maxEl.textContent = max;
      if (base > max && max > 0) currentEl.classList.add('over');
      if (base < 0) currentEl.classList.add('under');

      // Show/hide temp stamina display
      if (temp > 0) {
        tempDisplay.style.display = 'block';
        tempEl.textContent = temp;
      } else {
        tempDisplay.style.display = 'none';
      }

      // Determine character condition
      const windedValue = Math.floor(max / 2);
      const conditionEl = document.getElementById('conditionDisplay');
      let text = '';
      let color = '';

      if (base <= -windedValue && windedValue > 0) {
        text = 'Dead';
        color = '#ef4444';
      } else if (base <= 0) {
        text = 'Dying';
        color = '#ef4444';
      } else if (base <= windedValue && max > 0) {
        text = 'Winded';
        color = '#facc15';
      }

      if (text) {
        conditionEl.textContent = text;
        conditionEl.style.color = color;
        conditionEl.style.display = 'block';
      } else {
        conditionEl.style.display = 'none';
      }

      // Calculate stamina bar segments
      let green = 0, yellow = 0, red = 0, black = 0;

      if (base >= max) {
        green = 100;  // Full green bar
      } else if (base > 0) {
        if (base <= windedValue) {
          yellow = (base / max) * 100;  // Winded portion
        } else {
          green = (base / max) * 100;
        }
      } else {
        red = Math.min((-base <= windedValue ? -base : windedValue) / max * 100, 100);
        black = (-base > windedValue ? (-base - windedValue) / max * 100 : 0);
        if (base <= -windedValue) {
          red = 0;
          black = 100;
        }
      }

      // Update bar segment widths and visibility
      greenSeg.style.width = green + '%';
      greenSeg.style.display = green > 0 ? 'block' : 'none';
      yellowSeg.style.width = yellow + '%';
      yellowSeg.style.display = yellow > 0 ? 'block' : 'none';
      redSeg.style.width = red + '%';
      redSeg.style.left = (green + yellow) + '%';
      redSeg.style.display = red > 0 ? 'block' : 'none';
      blackSeg.style.width = black + '%';
      blackSeg.style.left = (green + yellow + red) + '%';
      blackSeg.style.display = black > 0 ? 'block' : 'none';
    }
  </script>
</body>
</html>
